#include <stdio.h>
#include ".\terasic_lib\terasic_includes.h"
#include ".\spectrum_comm\DMA\dma_hal.h"


void DMA_print_err(int ret) {
	switch (ret) {
		case TIMEOUT:
			printf("DMA request timeout");
			break;
		case ALREADY_DONE:
			printf("DMA request already done");
			break;
		default: printf("Unknown err");
	}
}

int main() {
	int ret;

	DMA_init();

	ret = DMA_request(10);

	if (ret != 0) {
		DMA_print_err(ret);
	}

	// Memory

	alt_u16 addr = 0x5800;
	alt_u8 data = 0b10010101;
	write_mem(addr, data);

	addr = 0x5801;
	data = read_mem(addr);
	printf("read mem: 0x%x\r\n", data);

	// IO
	addr = 0xFEFE;
	data = 0b00000100;
	write_io(addr, data);

	data = read_io(addr);
	printf("read io: 0b%b\r\n", data);

	ret = DMA_stop(10);
	printf("%d", ret);

	return 0;

}
